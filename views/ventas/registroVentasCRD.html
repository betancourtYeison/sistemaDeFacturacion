<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Registro de Ventas
  </h1>
  <ol class="breadcrumb">
    <li><a href="#/"><i class="fa fa-home"></i> Inicio</a></li>
    <li><a href="#/registroVentasCRD">Ventas</a></li>
    <li class="active">Registro de Ventas</li>
  </ol>
</section>

<!-- Main content -->
<section class="content"> 
  <div class="row" id="pdf2htmldiv">
    <div class="col-lg-12">      
      <form id="form-registro-compra" role="form" name="form" ng-controller="ClientesCtrlCRD">
        <div class="row">
          <div class="col-md-2">            
            Datos del Cliente:  
            <div class="form-group has-feedback" ng-class="{'has-error': form.name.$invalid, 'has-success': form.name.$valid}">           
              <input id="inputname" type="text" class="form-control" placeholder="Buscar por nombre" aria-label="..." name="name" ng-model="customerName" ng-change="loadNameCustomer()" style="padding-right: 0px;" required/>
              <ul class="dropdown-menu dropdown-menu-right dropdown-menu-customerName">
                <li ng-repeat="customer in customers">
                  <a style="cursor: pointer;" ng-click="changeCustomer('name', customer.name, customer.id, customer.phone)">
                      {{ customer.name }}
                  </a>
                </li>
              </ul> 
              <div ng-show="form.name.$dirty && form.name.$invalid">
                <p class="help-block text-danger" ng-show="form.name.$error.required">Campo obligatorio</p>
              </div>           
            </div>        
          </div>
          <div class="col-md-2"> 
            &nbsp;                     
            <div class="form-group has-feedback" ng-class="{'has-error': form.id.$invalid, 'has-success': form.id.$valid}">           
              <input id="inputId" type="text" class="form-control" placeholder="Buscar por cédula" aria-label="..." name="id" ng-model="customerId" ng-change="loadIdCustomer()" style="padding-right: 0px;" required/>  
              <ul class="dropdown-menu dropdown-menu-right dropdown-menu-customerId">
                <li ng-repeat="customer in customers">
                  <a style="cursor: pointer;" ng-click="changeCustomer('id', customer.name, customer.id, customer.phone)">
                      {{ customer.id }}
                  </a>
                </li>
              </ul>
              <div ng-show="form.id.$dirty && form.id.$invalid">
                <p class="help-block text-danger" ng-show="form.id.$error.required">Campo obligatorio</p>
              </div>           
            </div>        
          </div>
          <div class="col-md-2">            
            &nbsp;
            <div class="form-group has-feedback" ng-class="{'has-error': form.phone.$invalid, 'has-success': form.phone.$valid}">           
              <input id="inputPhone" type="text" class="form-control" placeholder="Buscar por teléfono" aria-label="..." name="phone" ng-model="customerPhone" ng-change="loadPhoneCustomer()" style="padding-right: 0px;" required/>                    
              <ul class="dropdown-menu dropdown-menu-right dropdown-menu-customerPhone">
                <li ng-repeat="customer in customers">
                  <a style="cursor: pointer;" ng-click="changeCustomer('phone', customer.name, customer.id, customer.phone)">
                      {{ customer.phone }}
                  </a>
                </li>
              </ul>  
              <div ng-show="form.phone.$dirty && form.phone.$invalid">
                <p class="help-block text-danger" ng-show="form.phone.$error.required">Campo obligatorio</p>
              </div>         
            </div>        
          </div>
          <div class="col-md-2 pull-right"> 
            <div>No. Factura: <input id="txt_fecha" type="text" class="col-md-2 form-control" ng-model="noFactura" disabled="">
            </div>
          </div>
          <div class="col-md-2 pull-right"> 
            <div>Fecha: <input id="txt_fecha" type="text" class="col-md-2 form-control" ng-model="fecha" disabled="">
            </div>
          </div>
        </div>      
        <br>      
        <div class="row" ng-controller="ListadoProductosCtrlCRD">
          <div class="col-md-2">  
            <div>Datos del Producto: 
              <div class="form-group has-feedback" ng-class="{'has-error': form.ref.$invalid, 'has-success': form.ref.$valid}">           
                <input id="inputname" type="text" class="form-control" placeholder="Buscar por referencia" aria-label="..." name="ref" ng-model="productRef" ng-change="loadProductRef()" style="padding-right: 0px;" required/>    
                <ul class="dropdown-menu dropdown-menu-right dropdown-menu-productRef">
                  <li ng-repeat="product in productsList">                  
                    <a style="cursor: pointer;" ng-click="changeProduct('referencia', product.referencia, product.codigoBarras, product.precioUnitario)">
                        {{ product.referencia }}
                    </a>
                  </li>
                </ul> 
                <div ng-show="form.ref.$dirty && form.ref.$invalid">
                  <p class="help-block text-danger" ng-show="form.ref.$error.required">Campo obligatorio</p>
                </div>           
              </div>                    
            </div>
          </div>
          <div class="col-md-2">  
            &nbsp;
            <div class="form-group has-feedback" ng-class="{'has-error': form.cod.$invalid, 'has-success': form.cod.$valid}">           
              <input id="inputcod" type="text" class="form-control" placeholder="Buscar por código" aria-label="..." name="cod" ng-model="productCod" ng-change="loadProductCodigo()" style="padding-right: 0px;" required/>
              <ul class="dropdown-menu dropdown-menu-right dropdown-menu-productCod">
                <li ng-repeat="product in productsList">
                  <a style="cursor: pointer;" ng-click="changeProduct('codigoBarras', product.referencia, product.codigoBarras, product.precioUnitario)">
                      {{ product.codigoBarras }}
                  </a>
                </li>
              </ul> 
              <div ng-show="form.cod.$dirty && form.cod.$invalid">
                <p class="help-block text-danger" ng-show="form.cod.$error.required">Campo obligatorio</p>
              </div>           
            </div>            
          </div>
          <div class="col-md-2"> 
            &nbsp;
            <div class="form-group has-feedback" ng-class="{'has-error': form.val.$invalid, 'has-success': form.val.$valid}">           
              <input id="inputcod" type="text" class="form-control" placeholder="Buscar por precio" aria-label="..." name="val" ng-model="productVal" ng-change="loadProductValue()" style="padding-right: 5px;" required/>
              <ul class="dropdown-menu dropdown-menu-right dropdown-menu-productVal">
                <li ng-repeat="product in productsList">
                  <a style="cursor: pointer;" ng-click="changeProduct('precioUnitario', product.referencia, product.codigoBarras, product.precioUnitario)">
                      {{ product.precioUnitario }}
                  </a>
                </li>
              </ul> 
              <div ng-show="form.val.$dirty && form.val.$invalid">
                  <p class="help-block text-danger" ng-show="form.val.$error.required">Campo obligatorio</p>
                </div> 
            </div>
          </div>
          <div class="col-md-2">  
            Cantidad del Producto:
            <div class="form-group has-feedback" ng-class="{'has-error': form.count.$invalid, 'has-success': form.count.$valid}">           
              <input id="inputcod" type="number" class="form-control" placeholder="###" aria-label="..." name="count" ng-model="productCount" style="padding-right: 5px;" required/>
              <div ng-show="form.count.$dirty && form.count.$invalid">
                  <p class="help-block text-danger" ng-show="form.count.$error.required">Campo obligatorio</p>
                </div> 
            </div>
          </div>
          <div class="col-md-2">
            Forma de Pago
            <div class="form-group has-feedback" ng-class="{'has-error': form.pago.$invalid, 'has-success': form.pago.$valid}">  
              <select id="inputpago" placeholder="Pago" class="form-control" name="pago" ng-model="productPago" required>
                <option value="1">Contado</option>
                <option value="2">Credito a 30 días</option>
              </select>
              <div ng-show="form.pago.$dirty && form.pago.$invalid">
                <p class="help-block text-danger" ng-show="form.pago.$error.required">Campo obligatorio</p>
              </div>  
              </div>      
          </div>
          <div class="col-md-2">
            <div class="text-center" style="padding-top: 20px;"><a ng-click="addProduct(customerName, customerId, customerPhone, productRef, productCod, productVal, productCount, productPago)" ng-disabled="form.$invalid" class="btn btn-md btn-success"><span class="glyphicon glyphicon-plus"></span>Agregar</a>
            </div>
          </div>
        </div>     
      </form>             
        <br>
      <!-- ADD_PAGE -->
      <form id="form-registroFactura-compra" role="form2" name="form2">
        <div class="panel panel-primary" id="detalle_compra">                       
          <div class="panel-body">
            <div class="table-responsive">
              <table class="table table-bordered table-hover">
                <thead>
                  <tr>
                    <th style="min-width: 150px;">
                      Referencia                  
                      <span ng-hide="sort" class="fa fa-sort-amount-asc" style="cursor: pointer" ng-click="ordenarPor('-referencia',true)"></span>
                      <span ng-show="sort" class="fa fa-sort-amount-desc" style="cursor: pointer" ng-click="ordenarPor('referencia',false)"></span>                                    
                    </th>
                    <th style="min-width: 80px; width: 150px;">
                      Código                  
                      <span ng-hide="sort" class="fa fa-sort-amount-asc" style="cursor: pointer" ng-click="ordenarPor('-id',true)"></span>
                      <span ng-show="sort" class="fa fa-sort-amount-desc" style="cursor: pointer" ng-click="ordenarPor('id',false)"></span>                                    
                    </th>
                    <th style="min-width: 80px; width: 150px;">Valor Unitario</th>
                    <th style="min-width: 80px; width: 150px;">Cantidad</th>
                    <th style="min-width: 80px; width: 150px;">Valor Total</th>
                    <th style="width:20px;"> </th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="producto in datosProducto | orderBy:ordenSeleccionado | filter:buscar">
                    <td sortable="id">{{ producto.referencia }}</td>
                    <td>{{ producto.codigo }}</td>
                    <td>{{ producto.valorUni }}</td>
                    <td><input ng-change="calculateValTot(producto)" ng-model="producto.cantidad"/></td>
                    <td>{{ producto.valorTot }}</td> 
                    <td><a ng-click="deleteProduct($index)" class="btn btn-small btn-danger"><span class="glyphicon glyphicon-remove"></span></a></td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-bottom-style: hidden;"></th> 
                    <th>Sub Total</th> 
                    <th>{{subTotal}}</th> 
                    <th style="border-bottom-style: hidden;"></th> 
                  </tr>  
                  <tr>
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-bottom-style: hidden;"></th> 
                    <th>Impuesto</th> 
                    <th>{{impuesto}}</th> 
                    <th style="border-bottom-style: hidden;"></th> 
                  </tr>    
                  <tr>
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-bottom-style: hidden;"></th> 
                    <th>Descuento %</th> 
                    <th><input ng-change="calculateTot()" ng-model="descuento"/></th> 
                    <th style="border-bottom-style: hidden;"></th> 
                  </tr>  
                  <tr>
                    <th style="border-right-style: hidden;"></th> 
                    <th style="border-right-style: hidden;"></th> 
                    <th></th> 
                    <th>Total Factura</th> 
                    <th>{{total}}</th> 
                    <th style="border-bottom-style: hidden;"></th> 
                  </tr>  
                  <tr>
                    <th style="border-right-style: hidden;"></th> 
                    <th style="border-right-style: hidden;"></th> 
                    <th style="border-right-style: hidden;"></th> 
                    <th></th> 
                    <th>
                    <div class="text-center"><a ng-click="createBil()"><button type="button" class="btn btn-md btn-success btn-grabar-compra"><span class="glyphicon glyphicon-floppy-disk"></span> Generar Factura</button></a>
                    </div>                    
                    </th> 
                    <th></th> 
                  </tr>                       
                </tfoot>            
              </table>
            </div>
          </div><!-- /.box-body -->
        </div>          
      </form>
    </div>
  </div>

</section><!-- /.content -->
